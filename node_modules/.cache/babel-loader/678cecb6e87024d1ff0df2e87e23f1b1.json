{"ast":null,"code":"\"use strict\";\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\nexports.decorateFixtureRefs = decorateFixtureRefs;\n\nvar _react = _interopRequireDefault(require(\"react\"));\n\nvar _nodeTree = require(\"../../shared/nodeTree\");\n\nvar _findRelevantElementPaths = require(\"../../shared/findRelevantElementPaths\");\n\nvar _isRefSupported = require(\"./isRefSupported\");\n\nfunction _interopRequireDefault(obj) {\n  return obj && obj.__esModule ? obj : {\n    default: obj\n  };\n}\n\nfunction decorateFixtureRefs(fixture, spyRef, cachedRefHandlers) {\n  var elPaths = (0, _findRelevantElementPaths.findRelevantElementPaths)(fixture);\n  return elPaths.reduce(function (decoratedFixture, elPath) {\n    return (0, _nodeTree.setElementAtPath)(decoratedFixture, elPath, function (element) {\n      if (!(0, _isRefSupported.isRefSupported)(element.type)) {\n        return element;\n      }\n\n      return _react.default.cloneElement(element, {\n        ref: getDecoratedRef(element.ref, spyRef, elPath, cachedRefHandlers)\n      });\n    });\n  }, fixture);\n}\n\nfunction getDecoratedRef(origRef, spyRef, elPath, cachedRefHandlers) {\n  var found = cachedRefHandlers[elPath];\n\n  if (found && found.origRef === origRef) {\n    return found.handler;\n  }\n\n  var handler = decorateRefWithSpy(origRef, spyRef, elPath);\n  cachedRefHandlers[elPath] = {\n    origRef: origRef,\n    handler: handler\n  };\n  return handler;\n}\n\nfunction decorateRefWithSpy(origRef, spyRef, elPath) {\n  return function (elRef) {\n    if (origRef) {\n      callOriginalRef(origRef, elRef);\n    }\n\n    spyRef(elPath, elRef);\n  };\n}\n\nfunction callOriginalRef(ref, elRef) {\n  if (typeof ref === 'string') {\n    console.warn('[decorateFixtureRefs] String refs are not supported');\n    return;\n  }\n\n  if (typeof ref === 'function') {\n    ref(elRef);\n    return;\n  }\n\n  var refObj = ref;\n  refObj.current = elRef;\n}","map":{"version":3,"sources":["/home/cubex/www/koruts/TASKS/node_modules/react-cosmos-shared2/dist/FixtureLoader/FixtureCapture/classState/decorateFixtureRefs/index.js"],"names":["Object","defineProperty","exports","value","decorateFixtureRefs","_react","_interopRequireDefault","require","_nodeTree","_findRelevantElementPaths","_isRefSupported","obj","__esModule","default","fixture","spyRef","cachedRefHandlers","elPaths","findRelevantElementPaths","reduce","decoratedFixture","elPath","setElementAtPath","element","isRefSupported","type","cloneElement","ref","getDecoratedRef","origRef","found","handler","decorateRefWithSpy","elRef","callOriginalRef","console","warn","refObj","current"],"mappings":"AAAA;;AAEAA,MAAM,CAACC,cAAP,CAAsBC,OAAtB,EAA+B,YAA/B,EAA6C;AAC3CC,EAAAA,KAAK,EAAE;AADoC,CAA7C;AAGAD,OAAO,CAACE,mBAAR,GAA8BA,mBAA9B;;AAEA,IAAIC,MAAM,GAAGC,sBAAsB,CAACC,OAAO,CAAC,OAAD,CAAR,CAAnC;;AAEA,IAAIC,SAAS,GAAGD,OAAO,CAAC,uBAAD,CAAvB;;AAEA,IAAIE,yBAAyB,GAAGF,OAAO,CAAC,uCAAD,CAAvC;;AAEA,IAAIG,eAAe,GAAGH,OAAO,CAAC,kBAAD,CAA7B;;AAEA,SAASD,sBAAT,CAAgCK,GAAhC,EAAqC;AAAE,SAAOA,GAAG,IAAIA,GAAG,CAACC,UAAX,GAAwBD,GAAxB,GAA8B;AAAEE,IAAAA,OAAO,EAAEF;AAAX,GAArC;AAAwD;;AAE/F,SAASP,mBAAT,CAA6BU,OAA7B,EAAsCC,MAAtC,EAA8CC,iBAA9C,EAAiE;AAC/D,MAAIC,OAAO,GAAG,CAAC,GAAGR,yBAAyB,CAACS,wBAA9B,EAAwDJ,OAAxD,CAAd;AACA,SAAOG,OAAO,CAACE,MAAR,CAAe,UAAUC,gBAAV,EAA4BC,MAA5B,EAAoC;AACxD,WAAO,CAAC,GAAGb,SAAS,CAACc,gBAAd,EAAgCF,gBAAhC,EAAkDC,MAAlD,EAA0D,UAAUE,OAAV,EAAmB;AAClF,UAAI,CAAC,CAAC,GAAGb,eAAe,CAACc,cAApB,EAAoCD,OAAO,CAACE,IAA5C,CAAL,EAAwD;AACtD,eAAOF,OAAP;AACD;;AAED,aAAOlB,MAAM,CAACQ,OAAP,CAAea,YAAf,CAA4BH,OAA5B,EAAqC;AAC1CI,QAAAA,GAAG,EAAEC,eAAe,CAACL,OAAO,CAACI,GAAT,EAAcZ,MAAd,EAAsBM,MAAtB,EAA8BL,iBAA9B;AADsB,OAArC,CAAP;AAGD,KARM,CAAP;AASD,GAVM,EAUJF,OAVI,CAAP;AAWD;;AAED,SAASc,eAAT,CAAyBC,OAAzB,EAAkCd,MAAlC,EAA0CM,MAA1C,EAAkDL,iBAAlD,EAAqE;AACnE,MAAIc,KAAK,GAAGd,iBAAiB,CAACK,MAAD,CAA7B;;AAEA,MAAIS,KAAK,IAAIA,KAAK,CAACD,OAAN,KAAkBA,OAA/B,EAAwC;AACtC,WAAOC,KAAK,CAACC,OAAb;AACD;;AAED,MAAIA,OAAO,GAAGC,kBAAkB,CAACH,OAAD,EAAUd,MAAV,EAAkBM,MAAlB,CAAhC;AACAL,EAAAA,iBAAiB,CAACK,MAAD,CAAjB,GAA4B;AAC1BQ,IAAAA,OAAO,EAAEA,OADiB;AAE1BE,IAAAA,OAAO,EAAEA;AAFiB,GAA5B;AAIA,SAAOA,OAAP;AACD;;AAED,SAASC,kBAAT,CAA4BH,OAA5B,EAAqCd,MAArC,EAA6CM,MAA7C,EAAqD;AACnD,SAAO,UAAUY,KAAV,EAAiB;AACtB,QAAIJ,OAAJ,EAAa;AACXK,MAAAA,eAAe,CAACL,OAAD,EAAUI,KAAV,CAAf;AACD;;AAEDlB,IAAAA,MAAM,CAACM,MAAD,EAASY,KAAT,CAAN;AACD,GAND;AAOD;;AAED,SAASC,eAAT,CAAyBP,GAAzB,EAA8BM,KAA9B,EAAqC;AACnC,MAAI,OAAON,GAAP,KAAe,QAAnB,EAA6B;AAC3BQ,IAAAA,OAAO,CAACC,IAAR,CAAa,qDAAb;AACA;AACD;;AAED,MAAI,OAAOT,GAAP,KAAe,UAAnB,EAA+B;AAC7BA,IAAAA,GAAG,CAACM,KAAD,CAAH;AACA;AACD;;AAED,MAAII,MAAM,GAAGV,GAAb;AACAU,EAAAA,MAAM,CAACC,OAAP,GAAiBL,KAAjB;AACD","sourcesContent":["\"use strict\";\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\nexports.decorateFixtureRefs = decorateFixtureRefs;\n\nvar _react = _interopRequireDefault(require(\"react\"));\n\nvar _nodeTree = require(\"../../shared/nodeTree\");\n\nvar _findRelevantElementPaths = require(\"../../shared/findRelevantElementPaths\");\n\nvar _isRefSupported = require(\"./isRefSupported\");\n\nfunction _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }\n\nfunction decorateFixtureRefs(fixture, spyRef, cachedRefHandlers) {\n  var elPaths = (0, _findRelevantElementPaths.findRelevantElementPaths)(fixture);\n  return elPaths.reduce(function (decoratedFixture, elPath) {\n    return (0, _nodeTree.setElementAtPath)(decoratedFixture, elPath, function (element) {\n      if (!(0, _isRefSupported.isRefSupported)(element.type)) {\n        return element;\n      }\n\n      return _react.default.cloneElement(element, {\n        ref: getDecoratedRef(element.ref, spyRef, elPath, cachedRefHandlers)\n      });\n    });\n  }, fixture);\n}\n\nfunction getDecoratedRef(origRef, spyRef, elPath, cachedRefHandlers) {\n  var found = cachedRefHandlers[elPath];\n\n  if (found && found.origRef === origRef) {\n    return found.handler;\n  }\n\n  var handler = decorateRefWithSpy(origRef, spyRef, elPath);\n  cachedRefHandlers[elPath] = {\n    origRef: origRef,\n    handler: handler\n  };\n  return handler;\n}\n\nfunction decorateRefWithSpy(origRef, spyRef, elPath) {\n  return function (elRef) {\n    if (origRef) {\n      callOriginalRef(origRef, elRef);\n    }\n\n    spyRef(elPath, elRef);\n  };\n}\n\nfunction callOriginalRef(ref, elRef) {\n  if (typeof ref === 'string') {\n    console.warn('[decorateFixtureRefs] String refs are not supported');\n    return;\n  }\n\n  if (typeof ref === 'function') {\n    ref(elRef);\n    return;\n  }\n\n  var refObj = ref;\n  refObj.current = elRef;\n}"]},"metadata":{},"sourceType":"script"}