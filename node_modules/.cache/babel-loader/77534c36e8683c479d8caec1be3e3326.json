{"ast":null,"code":"\"use strict\";\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\nexports.FixtureLoader = void 0;\n\nvar _lodash = require(\"lodash\");\n\nvar _react = _interopRequireDefault(require(\"react\"));\n\nvar _react2 = require(\"../react\");\n\nvar _fixtureHelpers = require(\"./fixtureHelpers\");\n\nvar _FixtureProvider = require(\"./FixtureProvider\");\n\nfunction _interopRequireDefault(obj) {\n  return obj && obj.__esModule ? obj : {\n    default: obj\n  };\n}\n\nfunction _typeof(obj) {\n  \"@babel/helpers - typeof\";\n\n  if (typeof Symbol === \"function\" && typeof Symbol.iterator === \"symbol\") {\n    _typeof = function _typeof(obj) {\n      return typeof obj;\n    };\n  } else {\n    _typeof = function _typeof(obj) {\n      return obj && typeof Symbol === \"function\" && obj.constructor === Symbol && obj !== Symbol.prototype ? \"symbol\" : typeof obj;\n    };\n  }\n\n  return _typeof(obj);\n}\n\nfunction ownKeys(object, enumerableOnly) {\n  var keys = Object.keys(object);\n\n  if (Object.getOwnPropertySymbols) {\n    var symbols = Object.getOwnPropertySymbols(object);\n    if (enumerableOnly) symbols = symbols.filter(function (sym) {\n      return Object.getOwnPropertyDescriptor(object, sym).enumerable;\n    });\n    keys.push.apply(keys, symbols);\n  }\n\n  return keys;\n}\n\nfunction _objectSpread(target) {\n  for (var i = 1; i < arguments.length; i++) {\n    var source = arguments[i] != null ? arguments[i] : {};\n\n    if (i % 2) {\n      ownKeys(Object(source), true).forEach(function (key) {\n        _defineProperty(target, key, source[key]);\n      });\n    } else if (Object.getOwnPropertyDescriptors) {\n      Object.defineProperties(target, Object.getOwnPropertyDescriptors(source));\n    } else {\n      ownKeys(Object(source)).forEach(function (key) {\n        Object.defineProperty(target, key, Object.getOwnPropertyDescriptor(source, key));\n      });\n    }\n  }\n\n  return target;\n}\n\nfunction _classCallCheck(instance, Constructor) {\n  if (!(instance instanceof Constructor)) {\n    throw new TypeError(\"Cannot call a class as a function\");\n  }\n}\n\nfunction _defineProperties(target, props) {\n  for (var i = 0; i < props.length; i++) {\n    var descriptor = props[i];\n    descriptor.enumerable = descriptor.enumerable || false;\n    descriptor.configurable = true;\n    if (\"value\" in descriptor) descriptor.writable = true;\n    Object.defineProperty(target, descriptor.key, descriptor);\n  }\n}\n\nfunction _createClass(Constructor, protoProps, staticProps) {\n  if (protoProps) _defineProperties(Constructor.prototype, protoProps);\n  if (staticProps) _defineProperties(Constructor, staticProps);\n  return Constructor;\n}\n\nfunction _inherits(subClass, superClass) {\n  if (typeof superClass !== \"function\" && superClass !== null) {\n    throw new TypeError(\"Super expression must either be null or a function\");\n  }\n\n  subClass.prototype = Object.create(superClass && superClass.prototype, {\n    constructor: {\n      value: subClass,\n      writable: true,\n      configurable: true\n    }\n  });\n  if (superClass) _setPrototypeOf(subClass, superClass);\n}\n\nfunction _setPrototypeOf(o, p) {\n  _setPrototypeOf = Object.setPrototypeOf || function _setPrototypeOf(o, p) {\n    o.__proto__ = p;\n    return o;\n  };\n\n  return _setPrototypeOf(o, p);\n}\n\nfunction _createSuper(Derived) {\n  var hasNativeReflectConstruct = _isNativeReflectConstruct();\n\n  return function () {\n    var Super = _getPrototypeOf(Derived),\n        result;\n\n    if (hasNativeReflectConstruct) {\n      var NewTarget = _getPrototypeOf(this).constructor;\n\n      result = Reflect.construct(Super, arguments, NewTarget);\n    } else {\n      result = Super.apply(this, arguments);\n    }\n\n    return _possibleConstructorReturn(this, result);\n  };\n}\n\nfunction _possibleConstructorReturn(self, call) {\n  if (call && (_typeof(call) === \"object\" || typeof call === \"function\")) {\n    return call;\n  }\n\n  return _assertThisInitialized(self);\n}\n\nfunction _assertThisInitialized(self) {\n  if (self === void 0) {\n    throw new ReferenceError(\"this hasn't been initialised - super() hasn't been called\");\n  }\n\n  return self;\n}\n\nfunction _isNativeReflectConstruct() {\n  if (typeof Reflect === \"undefined\" || !Reflect.construct) return false;\n  if (Reflect.construct.sham) return false;\n  if (typeof Proxy === \"function\") return true;\n\n  try {\n    Date.prototype.toString.call(Reflect.construct(Date, [], function () {}));\n    return true;\n  } catch (e) {\n    return false;\n  }\n}\n\nfunction _getPrototypeOf(o) {\n  _getPrototypeOf = Object.setPrototypeOf ? Object.getPrototypeOf : function _getPrototypeOf(o) {\n    return o.__proto__ || Object.getPrototypeOf(o);\n  };\n  return _getPrototypeOf(o);\n}\n\nfunction _defineProperty(obj, key, value) {\n  if (key in obj) {\n    Object.defineProperty(obj, key, {\n      value: value,\n      enumerable: true,\n      configurable: true,\n      writable: true\n    });\n  } else {\n    obj[key] = value;\n  }\n\n  return obj;\n}\n\nvar FixtureLoader = /*#__PURE__*/function (_React$Component) {\n  _inherits(FixtureLoader, _React$Component);\n\n  var _super = _createSuper(FixtureLoader);\n\n  function FixtureLoader() {\n    var _this;\n\n    _classCallCheck(this, FixtureLoader);\n\n    for (var _len = arguments.length, args = new Array(_len), _key = 0; _key < _len; _key++) {\n      args[_key] = arguments[_key];\n    }\n\n    _this = _super.call.apply(_super, [this].concat(args));\n\n    _defineProperty(_assertThisInitialized(_this), \"state\", {\n      selectedFixture: _this.props.selectedFixtureId ? {\n        fixtureId: _this.props.selectedFixtureId,\n        fixtureState: {},\n        syncedFixtureState: {}\n      } : null,\n      renderKey: 0\n    });\n\n    _defineProperty(_assertThisInitialized(_this), \"unsubscribe\", null);\n\n    _defineProperty(_assertThisInitialized(_this), \"handleRequest\", function (msg) {\n      if (msg.type === 'pingRenderers') {\n        return _this.postReadyState();\n      }\n\n      if (!msg.payload || msg.payload.rendererId !== _this.props.rendererId) {\n        return;\n      }\n\n      if (doesRequestChangeFixture(msg)) {\n        _this.fireChangeCallback();\n      }\n\n      switch (msg.type) {\n        case 'selectFixture':\n          return _this.handleSelectFixtureRequest(msg);\n\n        case 'unselectFixture':\n          return _this.handleUnselectFixtureRequest();\n\n        case 'setFixtureState':\n          return _this.handleSetFixtureStateRequest(msg);\n\n        default: // This Is Fineâ„¢\n        // Actually, we can't be angry about getting unrelated messages here\n        // because we don't do any preliminary message filtering to ignore stuff\n        // like browser devtools communication, nor do we have any message\n        // metadata conventions in place to perform such filtering at the moment\n\n      }\n    });\n\n    _defineProperty(_assertThisInitialized(_this), \"postFixtureStateChange\", function (fixtureId, fixtureState) {\n      var rendererId = _this.props.rendererId;\n\n      _this.postMessage({\n        type: 'fixtureStateChange',\n        payload: {\n          rendererId: rendererId,\n          fixtureId: fixtureId,\n          fixtureState: fixtureState\n        }\n      });\n    });\n\n    _defineProperty(_assertThisInitialized(_this), \"setFixtureState\", function (stateUpdate) {\n      if (!_this.state.selectedFixture) {\n        console.warn('[FixtureLoader] Trying to set fixture state with no fixture selected');\n        return;\n      } // Multiple state changes can be dispatched by fixture plugins at almost\n      // the same time. Since state changes are batched in React, current state\n      // (this.state.fixtureState) can be stale at dispatch time, and extending\n      // it can result in cancelling previous state changes that are queued.\n      // Using an updater function like ({ prevState }) => nextState ensures\n      // every state change is honored, regardless of timing.\n\n\n      _this.setState(function (_ref) {\n        var selectedFixture = _ref.selectedFixture;\n\n        if (!selectedFixture) {\n          return null;\n        }\n\n        return {\n          selectedFixture: _objectSpread(_objectSpread({}, selectedFixture), {}, {\n            fixtureState: stateUpdate(selectedFixture.fixtureState)\n          })\n        };\n      });\n    });\n\n    return _this;\n  }\n\n  _createClass(FixtureLoader, [{\n    key: \"componentDidMount\",\n    value: function componentDidMount() {\n      if (!this.props.selectedFixtureId) {\n        var rendererConnect = this.props.rendererConnect;\n        this.unsubscribe = rendererConnect.onMessage(this.handleRequest);\n        this.postReadyState();\n      }\n    }\n  }, {\n    key: \"componentWillUnmount\",\n    value: function componentWillUnmount() {\n      if (this.unsubscribe) this.unsubscribe();\n    }\n  }, {\n    key: \"componentDidUpdate\",\n    value: function componentDidUpdate(prevProps) {\n      var fixtures = this.props.fixtures;\n\n      if (!(0, _lodash.isEqual)(fixtures, prevProps.fixtures)) {\n        this.postFixtureListUpdate();\n      }\n\n      var selectedFixture = this.state.selectedFixture;\n\n      if (selectedFixture) {\n        var fixtureId = selectedFixture.fixtureId,\n            fixtureState = selectedFixture.fixtureState,\n            syncedFixtureState = selectedFixture.syncedFixtureState;\n\n        if (fixtureId && !(0, _lodash.isEqual)(fixtureState, syncedFixtureState)) {\n          this.postFixtureStateChange(fixtureId, fixtureState);\n          this.updateSyncedFixtureState(fixtureState);\n        }\n      }\n    }\n  }, {\n    key: \"shouldComponentUpdate\",\n    value: function shouldComponentUpdate(prevProps, prevState) {\n      // This check exists mainly to prevent updating the fixture tree when\n      // fixture state setters resulted in no fixture state change\n      return !(0, _lodash.isEqual)(this.props, prevProps) || !(0, _lodash.isEqual)(this.state, prevState);\n    }\n  }, {\n    key: \"render\",\n    value: function render() {\n      var selectedFixture = this.state.selectedFixture;\n\n      if (!selectedFixture) {\n        return this.renderMessage('No fixture selected.');\n      }\n\n      var fixtures = this.props.fixtures;\n      var fixtureId = selectedFixture.fixtureId,\n          fixtureState = selectedFixture.fixtureState; // Falsy check doesn't do because fixtures can be any Node, including\n      // null or undefined.\n\n      if (!fixtures.hasOwnProperty(fixtureId.path)) {\n        return this.renderMessage(\"Fixture path not found: \".concat(fixtureId.path));\n      }\n\n      var fixtureExport = fixtures[fixtureId.path];\n      var fixture = (0, _fixtureHelpers.getFixture)(fixtureExport, fixtureId.name);\n\n      if (typeof fixture === 'undefined') {\n        return this.renderMessage(\"Invalid fixture ID: \".concat(JSON.stringify(fixtureId)));\n      }\n\n      var _this$props = this.props,\n          systemDecorators = _this$props.systemDecorators,\n          userDecorators = _this$props.userDecorators,\n          onErrorReset = _this$props.onErrorReset;\n      var renderKey = this.state.renderKey;\n      return /*#__PURE__*/_react.default.createElement(_FixtureProvider.FixtureProvider // renderKey controls whether to reuse previous instances (and\n      // transition props) or rebuild render tree from scratch\n      , {\n        key: renderKey,\n        fixtureId: fixtureId,\n        fixture: fixture,\n        systemDecorators: systemDecorators,\n        userDecorators: userDecorators,\n        fixtureState: fixtureState,\n        setFixtureState: this.setFixtureState,\n        onErrorReset: onErrorReset || noop\n      });\n    }\n  }, {\n    key: \"handleSelectFixtureRequest\",\n    value: function handleSelectFixtureRequest(_ref2) {\n      var payload = _ref2.payload;\n      var fixtureId = payload.fixtureId,\n          fixtureState = payload.fixtureState;\n      this.setState({\n        selectedFixture: {\n          fixtureId: fixtureId,\n          fixtureState: fixtureState,\n          syncedFixtureState: fixtureState\n        },\n        renderKey: this.state.renderKey + 1\n      });\n    }\n  }, {\n    key: \"handleUnselectFixtureRequest\",\n    value: function handleUnselectFixtureRequest() {\n      this.setState({\n        selectedFixture: null,\n        renderKey: 0\n      });\n    }\n  }, {\n    key: \"handleSetFixtureStateRequest\",\n    value: function handleSetFixtureStateRequest(_ref3) {\n      var payload = _ref3.payload;\n      var fixtureId = payload.fixtureId,\n          fixtureState = payload.fixtureState;\n      var selectedFixture = this.state.selectedFixture; // Ensure fixture state applies to currently selected fixture\n\n      if (selectedFixture && (0, _lodash.isEqual)(fixtureId, selectedFixture.fixtureId)) {\n        this.setState({\n          selectedFixture: {\n            fixtureId: fixtureId,\n            fixtureState: fixtureState,\n            syncedFixtureState: fixtureState\n          }\n        });\n      }\n    }\n  }, {\n    key: \"postReadyState\",\n    value: function postReadyState() {\n      var rendererId = this.props.rendererId;\n      this.postMessage({\n        type: 'rendererReady',\n        payload: {\n          rendererId: rendererId,\n          fixtures: this.getFixtureNamesByPath()\n        }\n      });\n    }\n  }, {\n    key: \"postFixtureListUpdate\",\n    value: function postFixtureListUpdate() {\n      var rendererId = this.props.rendererId;\n      this.postMessage({\n        type: 'fixtureListUpdate',\n        payload: {\n          rendererId: rendererId,\n          fixtures: this.getFixtureNamesByPath()\n        }\n      });\n    }\n  }, {\n    key: \"getFixtureNamesByPath\",\n    value: function getFixtureNamesByPath() {\n      return (0, _react2.getFixtureNamesByPath)(this.props.fixtures);\n    }\n  }, {\n    key: \"fireChangeCallback\",\n    value: function fireChangeCallback() {\n      var onErrorReset = this.props.onErrorReset;\n\n      if (typeof onErrorReset === 'function') {\n        onErrorReset();\n      }\n    }\n  }, {\n    key: \"updateSyncedFixtureState\",\n    value: function updateSyncedFixtureState(syncedFixtureState) {\n      this.setState(function (_ref4) {\n        var selectedFixture = _ref4.selectedFixture;\n\n        if (!selectedFixture) {\n          return null;\n        } // Other updates that alter state.selectedFixture can be pending when this\n        // update is submitted. Those updates will be applied first. With this in\n        // mind, we use a state setter callback to only override syncedFixtureState\n        // and keep the latest values of other state parts.\n\n\n        return {\n          selectedFixture: _objectSpread(_objectSpread({}, selectedFixture), {}, {\n            syncedFixtureState: syncedFixtureState\n          })\n        };\n      });\n    }\n  }, {\n    key: \"postMessage\",\n    value: function postMessage(msg) {\n      this.props.rendererConnect.postMessage(msg);\n    }\n  }, {\n    key: \"renderMessage\",\n    value: function renderMessage(msg) {\n      return typeof this.props.renderMessage !== 'undefined' ? this.props.renderMessage({\n        msg: msg\n      }) : msg;\n    }\n  }]);\n\n  return FixtureLoader;\n}(_react.default.Component);\n\nexports.FixtureLoader = FixtureLoader;\n\nfunction doesRequestChangeFixture(r) {\n  return r.type === 'selectFixture' || r.type === 'unselectFixture';\n}\n\nfunction noop() {}","map":{"version":3,"sources":["/home/cubex/www/koruts/TASKS/node_modules/react-cosmos-shared2/dist/FixtureLoader/FixtureLoader.js"],"names":["Object","defineProperty","exports","value","FixtureLoader","_lodash","require","_react","_interopRequireDefault","_react2","_fixtureHelpers","_FixtureProvider","obj","__esModule","default","_typeof","Symbol","iterator","constructor","prototype","ownKeys","object","enumerableOnly","keys","getOwnPropertySymbols","symbols","filter","sym","getOwnPropertyDescriptor","enumerable","push","apply","_objectSpread","target","i","arguments","length","source","forEach","key","_defineProperty","getOwnPropertyDescriptors","defineProperties","_classCallCheck","instance","Constructor","TypeError","_defineProperties","props","descriptor","configurable","writable","_createClass","protoProps","staticProps","_inherits","subClass","superClass","create","_setPrototypeOf","o","p","setPrototypeOf","__proto__","_createSuper","Derived","hasNativeReflectConstruct","_isNativeReflectConstruct","Super","_getPrototypeOf","result","NewTarget","Reflect","construct","_possibleConstructorReturn","self","call","_assertThisInitialized","ReferenceError","sham","Proxy","Date","toString","e","getPrototypeOf","_React$Component","_super","_this","_len","args","Array","_key","concat","selectedFixture","selectedFixtureId","fixtureId","fixtureState","syncedFixtureState","renderKey","msg","type","postReadyState","payload","rendererId","doesRequestChangeFixture","fireChangeCallback","handleSelectFixtureRequest","handleUnselectFixtureRequest","handleSetFixtureStateRequest","postMessage","stateUpdate","state","console","warn","setState","_ref","componentDidMount","rendererConnect","unsubscribe","onMessage","handleRequest","componentWillUnmount","componentDidUpdate","prevProps","fixtures","isEqual","postFixtureListUpdate","postFixtureStateChange","updateSyncedFixtureState","shouldComponentUpdate","prevState","render","renderMessage","hasOwnProperty","path","fixtureExport","fixture","getFixture","name","JSON","stringify","_this$props","systemDecorators","userDecorators","onErrorReset","createElement","FixtureProvider","setFixtureState","noop","_ref2","_ref3","getFixtureNamesByPath","_ref4","Component","r"],"mappings":"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","sourcesContent":["\"use strict\";\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\nexports.FixtureLoader = void 0;\n\nvar _lodash = require(\"lodash\");\n\nvar _react = _interopRequireDefault(require(\"react\"));\n\nvar _react2 = require(\"../react\");\n\nvar _fixtureHelpers = require(\"./fixtureHelpers\");\n\nvar _FixtureProvider = require(\"./FixtureProvider\");\n\nfunction _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }\n\nfunction _typeof(obj) { \"@babel/helpers - typeof\"; if (typeof Symbol === \"function\" && typeof Symbol.iterator === \"symbol\") { _typeof = function _typeof(obj) { return typeof obj; }; } else { _typeof = function _typeof(obj) { return obj && typeof Symbol === \"function\" && obj.constructor === Symbol && obj !== Symbol.prototype ? \"symbol\" : typeof obj; }; } return _typeof(obj); }\n\nfunction ownKeys(object, enumerableOnly) { var keys = Object.keys(object); if (Object.getOwnPropertySymbols) { var symbols = Object.getOwnPropertySymbols(object); if (enumerableOnly) symbols = symbols.filter(function (sym) { return Object.getOwnPropertyDescriptor(object, sym).enumerable; }); keys.push.apply(keys, symbols); } return keys; }\n\nfunction _objectSpread(target) { for (var i = 1; i < arguments.length; i++) { var source = arguments[i] != null ? arguments[i] : {}; if (i % 2) { ownKeys(Object(source), true).forEach(function (key) { _defineProperty(target, key, source[key]); }); } else if (Object.getOwnPropertyDescriptors) { Object.defineProperties(target, Object.getOwnPropertyDescriptors(source)); } else { ownKeys(Object(source)).forEach(function (key) { Object.defineProperty(target, key, Object.getOwnPropertyDescriptor(source, key)); }); } } return target; }\n\nfunction _classCallCheck(instance, Constructor) { if (!(instance instanceof Constructor)) { throw new TypeError(\"Cannot call a class as a function\"); } }\n\nfunction _defineProperties(target, props) { for (var i = 0; i < props.length; i++) { var descriptor = props[i]; descriptor.enumerable = descriptor.enumerable || false; descriptor.configurable = true; if (\"value\" in descriptor) descriptor.writable = true; Object.defineProperty(target, descriptor.key, descriptor); } }\n\nfunction _createClass(Constructor, protoProps, staticProps) { if (protoProps) _defineProperties(Constructor.prototype, protoProps); if (staticProps) _defineProperties(Constructor, staticProps); return Constructor; }\n\nfunction _inherits(subClass, superClass) { if (typeof superClass !== \"function\" && superClass !== null) { throw new TypeError(\"Super expression must either be null or a function\"); } subClass.prototype = Object.create(superClass && superClass.prototype, { constructor: { value: subClass, writable: true, configurable: true } }); if (superClass) _setPrototypeOf(subClass, superClass); }\n\nfunction _setPrototypeOf(o, p) { _setPrototypeOf = Object.setPrototypeOf || function _setPrototypeOf(o, p) { o.__proto__ = p; return o; }; return _setPrototypeOf(o, p); }\n\nfunction _createSuper(Derived) { var hasNativeReflectConstruct = _isNativeReflectConstruct(); return function () { var Super = _getPrototypeOf(Derived), result; if (hasNativeReflectConstruct) { var NewTarget = _getPrototypeOf(this).constructor; result = Reflect.construct(Super, arguments, NewTarget); } else { result = Super.apply(this, arguments); } return _possibleConstructorReturn(this, result); }; }\n\nfunction _possibleConstructorReturn(self, call) { if (call && (_typeof(call) === \"object\" || typeof call === \"function\")) { return call; } return _assertThisInitialized(self); }\n\nfunction _assertThisInitialized(self) { if (self === void 0) { throw new ReferenceError(\"this hasn't been initialised - super() hasn't been called\"); } return self; }\n\nfunction _isNativeReflectConstruct() { if (typeof Reflect === \"undefined\" || !Reflect.construct) return false; if (Reflect.construct.sham) return false; if (typeof Proxy === \"function\") return true; try { Date.prototype.toString.call(Reflect.construct(Date, [], function () {})); return true; } catch (e) { return false; } }\n\nfunction _getPrototypeOf(o) { _getPrototypeOf = Object.setPrototypeOf ? Object.getPrototypeOf : function _getPrototypeOf(o) { return o.__proto__ || Object.getPrototypeOf(o); }; return _getPrototypeOf(o); }\n\nfunction _defineProperty(obj, key, value) { if (key in obj) { Object.defineProperty(obj, key, { value: value, enumerable: true, configurable: true, writable: true }); } else { obj[key] = value; } return obj; }\n\nvar FixtureLoader = /*#__PURE__*/function (_React$Component) {\n  _inherits(FixtureLoader, _React$Component);\n\n  var _super = _createSuper(FixtureLoader);\n\n  function FixtureLoader() {\n    var _this;\n\n    _classCallCheck(this, FixtureLoader);\n\n    for (var _len = arguments.length, args = new Array(_len), _key = 0; _key < _len; _key++) {\n      args[_key] = arguments[_key];\n    }\n\n    _this = _super.call.apply(_super, [this].concat(args));\n\n    _defineProperty(_assertThisInitialized(_this), \"state\", {\n      selectedFixture: _this.props.selectedFixtureId ? {\n        fixtureId: _this.props.selectedFixtureId,\n        fixtureState: {},\n        syncedFixtureState: {}\n      } : null,\n      renderKey: 0\n    });\n\n    _defineProperty(_assertThisInitialized(_this), \"unsubscribe\", null);\n\n    _defineProperty(_assertThisInitialized(_this), \"handleRequest\", function (msg) {\n      if (msg.type === 'pingRenderers') {\n        return _this.postReadyState();\n      }\n\n      if (!msg.payload || msg.payload.rendererId !== _this.props.rendererId) {\n        return;\n      }\n\n      if (doesRequestChangeFixture(msg)) {\n        _this.fireChangeCallback();\n      }\n\n      switch (msg.type) {\n        case 'selectFixture':\n          return _this.handleSelectFixtureRequest(msg);\n\n        case 'unselectFixture':\n          return _this.handleUnselectFixtureRequest();\n\n        case 'setFixtureState':\n          return _this.handleSetFixtureStateRequest(msg);\n\n        default: // This Is Fineâ„¢\n        // Actually, we can't be angry about getting unrelated messages here\n        // because we don't do any preliminary message filtering to ignore stuff\n        // like browser devtools communication, nor do we have any message\n        // metadata conventions in place to perform such filtering at the moment\n\n      }\n    });\n\n    _defineProperty(_assertThisInitialized(_this), \"postFixtureStateChange\", function (fixtureId, fixtureState) {\n      var rendererId = _this.props.rendererId;\n\n      _this.postMessage({\n        type: 'fixtureStateChange',\n        payload: {\n          rendererId: rendererId,\n          fixtureId: fixtureId,\n          fixtureState: fixtureState\n        }\n      });\n    });\n\n    _defineProperty(_assertThisInitialized(_this), \"setFixtureState\", function (stateUpdate) {\n      if (!_this.state.selectedFixture) {\n        console.warn('[FixtureLoader] Trying to set fixture state with no fixture selected');\n        return;\n      } // Multiple state changes can be dispatched by fixture plugins at almost\n      // the same time. Since state changes are batched in React, current state\n      // (this.state.fixtureState) can be stale at dispatch time, and extending\n      // it can result in cancelling previous state changes that are queued.\n      // Using an updater function like ({ prevState }) => nextState ensures\n      // every state change is honored, regardless of timing.\n\n\n      _this.setState(function (_ref) {\n        var selectedFixture = _ref.selectedFixture;\n\n        if (!selectedFixture) {\n          return null;\n        }\n\n        return {\n          selectedFixture: _objectSpread(_objectSpread({}, selectedFixture), {}, {\n            fixtureState: stateUpdate(selectedFixture.fixtureState)\n          })\n        };\n      });\n    });\n\n    return _this;\n  }\n\n  _createClass(FixtureLoader, [{\n    key: \"componentDidMount\",\n    value: function componentDidMount() {\n      if (!this.props.selectedFixtureId) {\n        var rendererConnect = this.props.rendererConnect;\n        this.unsubscribe = rendererConnect.onMessage(this.handleRequest);\n        this.postReadyState();\n      }\n    }\n  }, {\n    key: \"componentWillUnmount\",\n    value: function componentWillUnmount() {\n      if (this.unsubscribe) this.unsubscribe();\n    }\n  }, {\n    key: \"componentDidUpdate\",\n    value: function componentDidUpdate(prevProps) {\n      var fixtures = this.props.fixtures;\n\n      if (!(0, _lodash.isEqual)(fixtures, prevProps.fixtures)) {\n        this.postFixtureListUpdate();\n      }\n\n      var selectedFixture = this.state.selectedFixture;\n\n      if (selectedFixture) {\n        var fixtureId = selectedFixture.fixtureId,\n            fixtureState = selectedFixture.fixtureState,\n            syncedFixtureState = selectedFixture.syncedFixtureState;\n\n        if (fixtureId && !(0, _lodash.isEqual)(fixtureState, syncedFixtureState)) {\n          this.postFixtureStateChange(fixtureId, fixtureState);\n          this.updateSyncedFixtureState(fixtureState);\n        }\n      }\n    }\n  }, {\n    key: \"shouldComponentUpdate\",\n    value: function shouldComponentUpdate(prevProps, prevState) {\n      // This check exists mainly to prevent updating the fixture tree when\n      // fixture state setters resulted in no fixture state change\n      return !(0, _lodash.isEqual)(this.props, prevProps) || !(0, _lodash.isEqual)(this.state, prevState);\n    }\n  }, {\n    key: \"render\",\n    value: function render() {\n      var selectedFixture = this.state.selectedFixture;\n\n      if (!selectedFixture) {\n        return this.renderMessage('No fixture selected.');\n      }\n\n      var fixtures = this.props.fixtures;\n      var fixtureId = selectedFixture.fixtureId,\n          fixtureState = selectedFixture.fixtureState; // Falsy check doesn't do because fixtures can be any Node, including\n      // null or undefined.\n\n      if (!fixtures.hasOwnProperty(fixtureId.path)) {\n        return this.renderMessage(\"Fixture path not found: \".concat(fixtureId.path));\n      }\n\n      var fixtureExport = fixtures[fixtureId.path];\n      var fixture = (0, _fixtureHelpers.getFixture)(fixtureExport, fixtureId.name);\n\n      if (typeof fixture === 'undefined') {\n        return this.renderMessage(\"Invalid fixture ID: \".concat(JSON.stringify(fixtureId)));\n      }\n\n      var _this$props = this.props,\n          systemDecorators = _this$props.systemDecorators,\n          userDecorators = _this$props.userDecorators,\n          onErrorReset = _this$props.onErrorReset;\n      var renderKey = this.state.renderKey;\n      return /*#__PURE__*/_react.default.createElement(_FixtureProvider.FixtureProvider // renderKey controls whether to reuse previous instances (and\n      // transition props) or rebuild render tree from scratch\n      , {\n        key: renderKey,\n        fixtureId: fixtureId,\n        fixture: fixture,\n        systemDecorators: systemDecorators,\n        userDecorators: userDecorators,\n        fixtureState: fixtureState,\n        setFixtureState: this.setFixtureState,\n        onErrorReset: onErrorReset || noop\n      });\n    }\n  }, {\n    key: \"handleSelectFixtureRequest\",\n    value: function handleSelectFixtureRequest(_ref2) {\n      var payload = _ref2.payload;\n      var fixtureId = payload.fixtureId,\n          fixtureState = payload.fixtureState;\n      this.setState({\n        selectedFixture: {\n          fixtureId: fixtureId,\n          fixtureState: fixtureState,\n          syncedFixtureState: fixtureState\n        },\n        renderKey: this.state.renderKey + 1\n      });\n    }\n  }, {\n    key: \"handleUnselectFixtureRequest\",\n    value: function handleUnselectFixtureRequest() {\n      this.setState({\n        selectedFixture: null,\n        renderKey: 0\n      });\n    }\n  }, {\n    key: \"handleSetFixtureStateRequest\",\n    value: function handleSetFixtureStateRequest(_ref3) {\n      var payload = _ref3.payload;\n      var fixtureId = payload.fixtureId,\n          fixtureState = payload.fixtureState;\n      var selectedFixture = this.state.selectedFixture; // Ensure fixture state applies to currently selected fixture\n\n      if (selectedFixture && (0, _lodash.isEqual)(fixtureId, selectedFixture.fixtureId)) {\n        this.setState({\n          selectedFixture: {\n            fixtureId: fixtureId,\n            fixtureState: fixtureState,\n            syncedFixtureState: fixtureState\n          }\n        });\n      }\n    }\n  }, {\n    key: \"postReadyState\",\n    value: function postReadyState() {\n      var rendererId = this.props.rendererId;\n      this.postMessage({\n        type: 'rendererReady',\n        payload: {\n          rendererId: rendererId,\n          fixtures: this.getFixtureNamesByPath()\n        }\n      });\n    }\n  }, {\n    key: \"postFixtureListUpdate\",\n    value: function postFixtureListUpdate() {\n      var rendererId = this.props.rendererId;\n      this.postMessage({\n        type: 'fixtureListUpdate',\n        payload: {\n          rendererId: rendererId,\n          fixtures: this.getFixtureNamesByPath()\n        }\n      });\n    }\n  }, {\n    key: \"getFixtureNamesByPath\",\n    value: function getFixtureNamesByPath() {\n      return (0, _react2.getFixtureNamesByPath)(this.props.fixtures);\n    }\n  }, {\n    key: \"fireChangeCallback\",\n    value: function fireChangeCallback() {\n      var onErrorReset = this.props.onErrorReset;\n\n      if (typeof onErrorReset === 'function') {\n        onErrorReset();\n      }\n    }\n  }, {\n    key: \"updateSyncedFixtureState\",\n    value: function updateSyncedFixtureState(syncedFixtureState) {\n      this.setState(function (_ref4) {\n        var selectedFixture = _ref4.selectedFixture;\n\n        if (!selectedFixture) {\n          return null;\n        } // Other updates that alter state.selectedFixture can be pending when this\n        // update is submitted. Those updates will be applied first. With this in\n        // mind, we use a state setter callback to only override syncedFixtureState\n        // and keep the latest values of other state parts.\n\n\n        return {\n          selectedFixture: _objectSpread(_objectSpread({}, selectedFixture), {}, {\n            syncedFixtureState: syncedFixtureState\n          })\n        };\n      });\n    }\n  }, {\n    key: \"postMessage\",\n    value: function postMessage(msg) {\n      this.props.rendererConnect.postMessage(msg);\n    }\n  }, {\n    key: \"renderMessage\",\n    value: function renderMessage(msg) {\n      return typeof this.props.renderMessage !== 'undefined' ? this.props.renderMessage({\n        msg: msg\n      }) : msg;\n    }\n  }]);\n\n  return FixtureLoader;\n}(_react.default.Component);\n\nexports.FixtureLoader = FixtureLoader;\n\nfunction doesRequestChangeFixture(r) {\n  return r.type === 'selectFixture' || r.type === 'unselectFixture';\n}\n\nfunction noop() {}"]},"metadata":{},"sourceType":"script"}